*********************************************************
       無圧縮ヘッダ読み取り DLL
*********************************************************
1. 背景
=========================================================

「アーカイブのヘッダーを読み取る部分をライブラリ化してみる！」

こーすりゃー、WMP プラグインだろうが Winamp プラグインだろうがな
んだろうが、いろんなアプリケーションから無圧縮ファイルを扱いやす
くなるんじゃない？

そう思ったのがきっかけでございます。


=========================================================
2. 仕様
=========================================================
2-1. 概要
---------------------------------------------------------

DLL のヘッダを読み取ることを目的としています。

ファイルのパスを与えると、含まれるファイルの数とそれぞれのファイ
ルが何バイト目から何バイト目まで記録されているかを返してくれます。
(無圧縮の場合は、"解凍" しているように見せかけることもできます。)


=========================================================
2-2. 詳細
---------------------------------------------------------

DLL を使いたい人と作りたい人がいると思いますので、それぞれの視点で
ドキュメントをまとめてみました。


---------------------------------------------------------
UINT WINAPI GetDllVersion()
---------------------------------------------------------
■ 意味
DLL が実装している仕様のバージョンを返す。

現バージョン 1.0 では次の値が有効である。
        VERSION1_0 (0x010) 

■ 利用する方向けの情報
将来的な変更に対応するために、必ず呼び出す必要がある。
おそらく、下位互換にする予定なんだけど....未定。

■ 作成する方向けの情報
現バージョン 1.0 では VERSION1_0 (0x010) を返す必要がある。


---------------------------------------------------------
UINT GetDllType()
---------------------------------------------------------
■ 意味
DLL が実装しているタイプを表す。

現バージョン 1.0 では次の値が有効である。
        #define  TYPE_READHEADER        0x001
        #define  TYPE_WRITEHEADER       0x002

■ 利用する方向けの情報
現バージョン 1.0 では 読み取り DLL の仕様しか策定されていないが、
将来的な変更に対応するために、TYPE_READHEADER のときだけ利用する
よう実装すべきである。


■ 作成する方向けの情報
現時点では読み取り DLL の仕様しか策定されていないので とりあえずは 1 を返す。


---------------------------------------------------------
BOOL ReadHeader(PCTSTR pszPath)
---------------------------------------------------------
■ 意味
与えられたファイルを読み取る。

第一引数
        解析するファイル

戻り値
        真：この DLL で解析ができる（もしくは解析に成功した場合）
        偽：この DLL で解析ができない（もしくは解析に失敗した場合）

■ 利用する方向けの情報
解析して欲しいファイルのパスを第一引数に与える。利用中の DLL で解析がで
きる場合は、真が戻り値になる。

エラーの理由は取得することができないので注意が必要。

戻り値が真であった場合、以下のヘッダ情報を取得する関数を利用することができる。


■ 作成する方向けの情報
第一引数のファイルを、アーカイブファイルとしてヘッダ情報を読み取りにかかる。
もし、読み取ることができるかどうかを 戻り値で返す。

この関数が呼び出された後、DLL を利用するプログラムは、ヘッダ情報を取得する
関数を呼び出すことが予想される。そのため、この関数の中で必要なヘッダ情報を
読み取りきるほうが実装が簡単だろう。


---------------------------------------------------------
UINT GetFileCount()
---------------------------------------------------------
■ 意味
アーカイブ ファイルに含まれるファイルの数。


---------------------------------------------------------
PCTSTR GetFileName(UINT uiIndex)
---------------------------------------------------------
■ 意味
アーカイブファイルの uiIndex 番目のファイルの名前を取得する。


---------------------------------------------------------
UINT GetFileStartPoint(UINT uiIndex)
---------------------------------------------------------
■ 意味
アーカイブファイルの uiIndex 番目のファイルがスタートするアドレスを
ビット単位で返す。


---------------------------------------------------------
UINT GetFileEndPoint(UINT uiIndex)
---------------------------------------------------------
■ 意味
アーカイブファイルの uiIndex 番目のファイルが終了するアドレスを
ビット単位で返す。

終了するアドレスは、ファイルの最終ビット＋１番地をさしている。

          uiIndex 番目のStartPoint   uiIndex番目のEndPoint
                       ↓              ↓
    ┯┯┯┯┯┳┯┯┯┯┯┯┯━┯┯┯┳┯┯┯┯
    ｜｜｜｜｜┃｜｜｜｜｜｜｜…｜｜｜┃｜｜｜｜
    ┴┴┴┴┴╂┴┴┴┼┴┴┴─┴┴┴╂┴┴┴┴
  uiIndex - 1 ┃ヘッダ｜ uiIndex 番目 ┃ヘッダ
    ━━━━━┻━━━┷━━━━━━━┻━━━━


---------------------------------------------------------
BOOL IsCompressed(UINT uiIndex)
---------------------------------------------------------
■ 意味
アーカイブファイルの uiIndex 番目のファイルが無圧縮であるかどう
かを返す。

戻り値
        真：圧縮されている
        偽：無圧縮


=========================================================
3. 仕様改変履歴
---------------------------------------------------------
ver 1.0
~~~~~~~
ZIP.MP3 再生プラグイソ。 0.3.2b に付属。
仕様のバージョン(1.0)を返すようにする。


ver 0.9
~~~~~~~
ZIP.MP3 再生プラグイソ。 0.3.0a/0.3.1a に付属。
仕様のバージョンを返していなかったので、闇に葬る。


ver 0.0
~~~~~~~
仮公開バージョン。
